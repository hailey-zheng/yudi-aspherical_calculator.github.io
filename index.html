<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <title>非球面计算器</title>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col justify-center items-center">
    <div class="bg-white p-8 rounded shadow-md w-full max-w-2xl">
        <h1 class="text-2xl font-bold mb-6">非球面计算器</h1>
        <form>
            <!-- 直径输入框 -->
            <div class="mb-4">
                <label for="diameter" class="block text-sm font-medium text-gray-700">直径 (1-600mm):</label>
                <input type="number" id="diameter" min="1" max="600" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>
            <!-- 高度输入框 -->
            <div class="mb-4">
                <label for="height" class="block text-sm font-medium text-gray-700">高度 (mm):</label>
                <input type="number" id="height" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>
            <!-- 件数输入框 -->
            <div class="mb-4">
                <label for="quantity" class="block text-sm font-medium text-gray-700">请输入件数 (1 - 50):</label>
                <input type="number" id="quantity" min="1" max="50" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>
            <!-- 请选择订单性质 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择订单性质</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="orderNatureSelf" name="orderNature" value="self" class="mr-2" checked>
                    <label for="orderNatureSelf">自产</label>
                </div>
                <div>
                    <input type="radio" id="orderNatureOutsourcing" name="orderNature" value="outsourcing" class="mr-2">
                    <label for="orderNatureOutsourcing">外协</label>
                </div>
            </div>
            <div id="diameterTip" class="text-red-500 hidden">100以下口径请选择外协，如果需要2级光洁度以采购询价为准</div>
            <!-- 材料选择 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择材料</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="optionA" name="material" value="1,0,0,0,0" class="mr-2">
                    <label for="optionA">A.小原微晶</label>
                </div>
                <div>
                    <input type="radio" id="optionB" name="material" value="0,1,0,0,0" class="mr-2">
                    <label for="optionB">B.肖特微晶</label>
                </div>
                <div>
                    <input type="radio" id="optionC" name="material" value="0,0,1,0,0" class="mr-2">
                    <label for="optionC">C.JGS1</label>
                </div>
                <div>
                    <input type="radio" id="optionD" name="material" value="0,0,0,1,0" class="mr-2">
                    <label for="optionD">D.JGS2</label>
                </div>
                <div>
                    <input type="radio" id="optionE" name="material" value="0,0,0,0,1" class="mr-2">
                    <label for="optionE">E. 客供料</label>
                </div>
            </div>
            <!-- PV选择 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择PV值</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="pvA" name="pv" value="0-1/2" class="mr-2">
                    <label for="pvA">A. 小于等于1/2</label>
                </div>
                <div>
                    <input type="radio" id="pvB" name="pv" value="greaterThan1/8" class="mr-2">
                    <label for="pvB">B. 优于1/2 小于等于1/8</label>
                </div>
                <div>
                    <input type="radio" id="pvC" name="pv" value="lessThan1/8" class="mr-2">
                    <label for="pvC">C.  优于1/8 小于1/10</label>
                </div>
            </div>
            <!-- rms选择 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择rms</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="rmsA" name="rms" value="lessThanEqual1/20" class="mr-2">
                    <label for="rmsA">A. 小于等于1/20</label>
                </div>
                <div>
                    <input type="radio" id="rmsB" name="rms" value="1/50" class="mr-2">
                    <label for="rmsB">B. 优于1/20 小于1/50</label>
                </div>
                <div>
                    <input type="radio" id="rmsC" name="rms" value="1/100" class="mr-2">
                    <label for="rmsC">C. 优于1/50 小于1/100</label>
                </div>
            </div>
            <div>
                <p class="text-danger text-sm font-medium flex items-center">
                    RMS优于1/100或PV优于1/10的请找工程部
                </p>
            </div>
            <br>
            <!-- 非球面度选择 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择非球面度</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="nsphericityA" name="nsphericity" value="0" class="mr-2">
                    <label for="nsphericityA">A. 0-20 um</label>
                </div>
                <div>
                    <input type="radio" id="nsphericityB" name="nsphericity" value="20" class="mr-2">
                    <label for="nsphericityB">B. 21-300 um</label>
                </div>
                <div>
                    <input type="radio" id="nsphericityC" name="nsphericity" value="300" class="mr-2">
                    <label for="nsphericityC">C. 301-1000 um</label>
                </div>
                <div>
                    <input type="radio" id="nsphericityD" name="nsphericity" value="10000" class="mr-2">
                    <label for="nsphericityD">D. 1000 um以上</label>
                </div>
            </div>
            <!-- 光洁度选择 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择光洁度</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="finishA" name="finish" value="II级" class="mr-2">
                    <label for="finishA">A. II级</label>
                </div>
                <div>
                    <input type="radio" id="finishB" name="finish" value="III级" class="mr-2">
                    <label for="finishB">B. III级</label>
                </div>
                <div>
                    <input type="radio" id="finishC" name="finish" value="IV级" class="mr-2">
                    <label for="finishC">C. IV级</label>
                </div>
            </div>
            <!-- 请选择客户验收方式 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择客户验收方式</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="acceptanceA" name="acceptance" value="report" class="mr-2">
                    <label for="acceptanceA">A. 提供检测报告</label>
                </div>
                <div>
                    <input type="radio" id="acceptanceB" name="acceptance" value="on-site" class="mr-2">
                    <label for="acceptanceB">B. 客户现场验收</label>
                </div>
            </div>
            <!-- 请选择检测方式 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择检测方式</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="detectionA" name="detection" value="standard" class="mr-2">
                    <label for="detectionA">A. 干涉仪/luphoscan/三坐标</label>
                </div>
                <div>
                    <input type="radio" id="detectionB" name="detection" value="custom-cgh" class="mr-2">
                    <label for="detectionB">B. 需要定制CGH</label>
                </div>
            </div>
            <!-- 请选择检测 -->
            <p class="text-base font-medium text-gray-700 mb-2">请选择检测</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="testA" name="test" value="single-mirror" class="mr-2">
                    <label for="testA">A. 单镜面型</label>
                </div>
                <div>
                    <input type="radio" id="testB" name="test" value="system-mirror" class="mr-2">
                    <label for="testB">B. 系统面型</label>
                </div>
            </div>
            <!-- 是否需要镀膜选择 -->
            <p class="text-base font-medium text-gray-700 mb-2">是否需要镀膜</p>
            <div class="flex flex-wrap space-x-4 mb-6">
                <div>
                    <input type="radio" id="coatingYes" name="coating" value="yes" class="mr-2">
                    <label for="coatingYes">是</label>
                </div>
                <div>
                    <input type="radio" id="coatingNo" name="coating" value="no" class="mr-2" checked>
                    <label for="coatingNo">否</label>
                </div>
            </div>
            <!-- 镀膜类型选择 -->
            <div id="coatingOptions" class="hidden">
                <p class="text-base font-medium text-gray-700 mb-2">请选择镀膜类型</p>
                <div class="flex flex-wrap space-x-4 mb-6">
                    <div>
                        <input type="radio" id="coatingA" name="coatingType" value="gold" class="mr-2">
                        <label for="coatingA">A.镀金</label>
                    </div>
                    <div>
                        <input type="radio" id="coatingB" name="coatingType" value="silver" class="mr-2">
                        <label for="coatingB">B.镀银</label>
                    </div>
                    <div>
                        <input type="radio" id="coatingC" name="coatingType" value="aluminum" class="mr-2">
                        <label for="coatingC">C.镀铝</label>
                    </div>
                </div>
            </div>
            <button type="button" id="submitButton" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">提交</button>
        </form>
        <div id="result" class="mt-4 text-lg font-bold"></div>
    </div>

    <script>
        const submitButton = document.getElementById('submitButton');
        const resultDiv = document.getElementById('result');
        const coatingYes = document.getElementById('coatingYes');
        const coatingOptions = document.getElementById('coatingOptions');
        const diameterInput = document.getElementById('diameter');
        const diameterTip = document.getElementById('diameterTip');

        coatingYes.addEventListener('change', function () {
            if (this.checked) {
                coatingOptions.classList.remove('hidden');
            } else {
                coatingOptions.classList.add('hidden');
            }
        });

        diameterInput.addEventListener('input', function () {
            const diameter = parseFloat(this.value);
            if (!isNaN(diameter) && diameter < 100) {
                diameterTip.classList.remove('hidden');
            } else {
                diameterTip.classList.add('hidden');
            }
        });

        submitButton.addEventListener('click', function () {
            const diameter = parseFloat(document.getElementById('diameter').value);
            const height = parseFloat(document.getElementById('height').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            const materialOption = document.querySelector('input[name="material"]:checked');
            const rmsOption = document.querySelector('input[name="rms"]:checked');
            const finishOption = document.querySelector('input[name="finish"]:checked');
            const nsphericityOption = document.querySelector('input[name="nsphericity"]:checked');
            const pvOption = document.querySelector('input[name="pv"]:checked');
            const acceptanceOption = document.querySelector('input[name="acceptance"]:checked');
            const detectionOption = document.querySelector('input[name="detection"]:checked');
            const testOption = document.querySelector('input[name="test"]:checked');
            const coatingOption = document.querySelector('input[name="coating"]:checked');
            const coatingTypeOption = document.querySelector('input[name="coatingType"]:checked');
            const orderNatureOption = document.querySelector('input[name="orderNature"]:checked');

            if (isNaN(diameter) || isNaN(height) || isNaN(quantity) || quantity < 1 || quantity > 50 ||!materialOption ||!rmsOption ||!finishOption ||!nsphericityOption ||!pvOption ||!acceptanceOption ||!detectionOption ||!testOption ||!orderNatureOption) {
                resultDiv.textContent = '请输入有效的数据。';
                return;
            }

            const materialStr = materialOption.value;
            const material = materialStr.split(',').map(Number);
            const rmsValue = rmsOption.value === '1/100'? 1 / 100 : rmsOption.value === 'lessThanEqual1/20'? 1 / 20 : 1 / 50;

            const m_d = [2.55, 2.55, 2.21, 2.21, 0];
            const m_p = [2500, 3700, 1400, 500, 0];
            const m_time = [10, 10, 7, 7, 0];
            const msmall_time = [7, 7, 5, 5, 0];
            let material_time = dotProduct(m_time, material);
            const material_density = dotProduct(m_d, material);
            const radius = diameter / 2;
            const volume = Math.PI * Math.pow(radius + 20, 2) * (height + 2.5) * 0.000001;
            const weight = volume * material_density;

            let m_price = dotProduct(m_p, material);

            if (diameter > 399) {
                if (materialOption.value === "1,0,0,0,0" || materialOption.value === "0,1,0,0,0" ) {
                    material_time += 5;
                    m_price += 200;
                }
            }

            const mmprice = Math.ceil(weight * m_price); 
            const material_price = Math.ceil(mmprice * quantity); 

            let bValue;
            if (finishOption.value === 'II级') {
                bValue = 2;
            } else if (finishOption.value === 'III级') {
                bValue = 3;
            } else {
                bValue = 4;
            }

            let aValue;
            if (nsphericityOption.value === '0') {
                aValue = 1;
            } else if (nsphericityOption.value === '20') {
                aValue = 2;
            } else if (nsphericityOption.value === '300') {
                aValue = 3;
            } else {
                aValue = 4;
            }

            let ptime;
            let mintime;
            let n;
            if (diameter <= 100) {
                ptime = 17;
            } else if (diameter <= 200) {
                ptime = 17;
            } else if (diameter <= 300) {
                ptime = 17;
            } else if (diameter <= 400) {
                mintime = 17;
                n = diameter - 300
                ptime = mintime + 5 * (n / 100);
            } else if (diameter <= 500) {
                mintime = 22;
                n = diameter - 400
                ptime = mintime + 10 * (n / 100);
            } else if (diameter <= 600) {
                mintime = 32;
                n = diameter - 500
                ptime = mintime + 10 * (n / 100);
            } else if (diameter <= 700) {
                mintime = 42;
                n = diameter - 600
                ptime = mintime + 10 * (n / 100);
            } else if (diameter <= 999) {
                mintime = 52;
                n = diameter - 700
                ptime = mintime + 20 * (n / 299);
            } else if (diameter >= 1000) {
                ptime = 92;
            } else {
                ptime = 0;
            }

            let btime;
            if (bValue === 3) {
                btime = 0.1;
            } else if (bValue === 2) {
                btime = 0.3;
            } else {
                btime = 0;
            }

            let atime;
            if (aValue === 2) {
                atime = 0.05;
            } else if (aValue === 3) {
                atime = 0.10;
            } else if (aValue === 4) {
                atime = 0.15;
            } else {
                atime = 0;
            }

            const pvValue = pvOption.value;
            const pvtime = pvValue === 'greaterThan1/8'? 0 : pvValue === 'lessThan1/8'? 0.1 : 0;

            let rtime = 0;
            if (rmsOption.value === '1/100') {
                rtime = 2;
            }

            let testtime1 = 0;
            if (acceptanceOption.value === 'on-site') {
                testtime1 = 2;
            }

            let testtime2 = 0;
            if (detectionOption.value!== 'standard') {
                testtime2 = 2;
            }

            let testtime3 = 0;
            if (testOption.value === 'system-mirror') {
                testtime3 = 7;
            }

            let testtime = testtime1 + testtime2 + testtime3;
            let delitime = 5;

            let omcost = 0;
            let omtime = 0;
            let undertime = 0;
            if (pvOption.value === '0-1/2' && rmsOption.value === 'lessThanEqual1/20') {
                undertime = -2;
            }

            let ttime = ptime * (1 + atime + pvtime + btime) + rtime + undertime;

            if (orderNatureOption.value === 'outsourcing') {
                if (diameter <= 50) {
                    omcost = 3000;
                    omtime = 14;
                    ttime = 0;
                } else if (diameter < 100) {
                    omcost = 3000 + (2000 / 49) * (diameter - 50);
                    omtime = 16;
                    ttime = 0;
                }
                material_time = dotProduct(msmall_time, material);
                delitime = 2;
            }

            /////////// time ///////////////
            const time2 = 7 * (quantity - 1);
            let allprotime = ttime + omtime + testtime + 3;
            let ftime = ( material_time + allprotime + delitime);
            const qtime = ftime + time2;  //总交期
 
            let contant = 1;
            let x;
            let min;
            if (diameter <= 100) {
                contant = 1.5;
            } else if (diameter <= 200) {
                min = 1.5;
                x = diameter - 100;
                contant = min +  0.5 * (x / 100);
            } else if (diameter <= 300) {
                min = 2;
                x = diameter - 200;
                contant = min + 1 * (x / 100);
            } else if (diameter <= 400) {
                min = 3;
                x = diameter - 300;
                contant = min + 1.5 * (x / 100);
            } else if (diameter <= 500) {
                min = 4.5;
                x = diameter - 400;
                contant = min + 1 * (x / 100);
            } else if (diameter <= 600) {
                min = 5.5;
                x = diameter - 500;
                contant = min + 1.5 * (x / 100);
            } else {
                contant = 1;
            }

            let coating = 0;
            let y;
	    let ctime = 0;
            if (coatingOption.value === 'yes' && coatingTypeOption) {
                const coatingType = coatingTypeOption.value;
                if (coatingType === 'gold') {
                    if (diameter < 400) {
                        if (diameter <= 390 && quantity <= 4) {
                            y = 1;
                        } else if (diameter <= 390 && quantity > 4) {
                            y = Math.ceil(quantity / 4); 
                        } else if (diameter > 390) {
                            y = quantity;
                        }
                        coating = 15000 * y;
                    } else {
                        y = quantity;
                        coating = 30000 * y;
                    }
                } else if (coatingType === 'silver') {
                    if (diameter < 400) {
                        if (diameter <= 390 && quantity <= 4) {
                            y = 1;
                        } else if (diameter <= 390 && quantity > 4) {
                            y = Math.ceil(quantity / 4); 
                        } else if (diameter > 390) {
                            y = quantity;
                        }
                        coating = 5000 * y;
                    } else {
                        y = quantity;
                        coating = 10000 * y;
                    }
                } else if (coatingType === 'aluminum') {
                    if (diameter < 400) {
                        if (diameter <= 390 && quantity <= 4) {
                            y = 1;
                        } else if (diameter <= 390 && quantity > 4) {
                            y = Math.ceil(quantity / 4); 
                        } else if (diameter > 390) {
                            y = quantity;
                        }
                        coating = 3000 * y;
                    } else {
                        y = quantity;
                        coating = 6000 * y;
                    }
                }
                if (diameter < 400) {
                    ctime += 5;
                } else {
                    ctime += 7;
                }
            }

            let quantitydis;
            if (quantity <= 4) {
                quantitydis = 1;
            } else if (quantity <= 10) {
                quantitydis = 0.85;
            } else if (quantity <= 50) {
                quantitydis = 0.7;
            } else {
                quantitydis = 0; 
            }

            let fixedcost = 90 * (ftime);
            let hcost = 390 * (allprotime);
            let cost = mmprice + hcost + + omcost + fixedcost ;
            let tcost = cost * quantity;

            let pcsprice = mmprice + ((hcost + + omcost + fixedcost ) * contant * quantitydis) ; 
            pcsprice = Math.ceil(pcsprice * 1.18); 

            let lowpr = pcsprice * 0.9;
            let highpr = pcsprice * 1.3;
            let lowto = lowpr * quantity;
            let highto = highpr * quantity;

            let resultHtml = `
                件数: ${quantity}<br>
                体积: ${volume.toFixed(1)} 立方米<br>
                重量: ${weight.toFixed(1)} kg<br>
                材料采购时间: ${material_time} 天<br>
                材料单价: ${mmprice} 元<br>
                材料价格: ${material_price} 元<br>
                <br>
                最快单件交期：${ftime.toFixed(1)} 天<br>
                最快总交期：${qtime.toFixed(1)} 天<br>
                <br>
                建议最低报价：单价：${lowpr.toFixed(1)} 元     总价：${lowto.toFixed(1)} 元<br>
                建议最高报价：单价：${highpr.toFixed(1)} 元     总价： ${highto.toFixed(1)} 元<br>
                <br>
                预估镀膜价格：${coating} 元
            `;

            if (detectionOption.value === 'custom-cgh') {
                resultHtml += '<br><span class="text-red-500">如需我们定制CGH，预估成本需要增加3 - 4万，具体找采购询价</span>';
            }

            resultDiv.innerHTML = resultHtml;
        });

        function dotProduct(a, b) {
            let result = 0;
            for (let i = 0; i < a.length; i++) {
                result += a[i] * b[i];
            }
            return result;
        }
    </script>
</body>

</html>
